  services:
    postgres:
      image: postgres:16-alpine
      container_name: smartdocs-postgres
      restart: unless-stopped
      environment:
        POSTGRES_USER: ${POSTGRES_USER}
        POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
        POSTGRES_DB: ${POSTGRES_DB}
      volumes:
        - postgres_data:/var/lib/postgresql/data
      ports:
        - "5432:5432"

    backend:
      build:
        context: ./backend
        dockerfile: Dockerfile
      container_name: smartdocs-backend
      restart: unless-stopped
      depends_on:
        - postgres
      environment:
        DATABASE_URL: ${DATABASE_URL}
        JWT_SECRET: ${BACKEND_JWT_SECRET}
        JWT_EXPIRES_IN: ${BACKEND_JWT_EXPIRES_IN}
        PORT: ${BACKEND_PORT}
      ports:
        - "${BACKEND_PORT}:3001"

    frontend:
      build:
        context: ./frontend
        dockerfile: Dockerfile
      container_name: smartdocs-frontend
      restart: unless-stopped
      depends_on:
        - backend
      environment:
        BACKEND_URL: ${BACKEND_URL}
        NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL}
        SESSION_SECRET: ${SESSION_SECRET}
        PORT: ${FRONTEND_PORT}
      ports:
        - "${FRONTEND_PORT}:3000"

  volumes:
    postgres_data:
